<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>HTML5 Canvas</title>
        <link rel="icon" href="https://fav.farm/ğŸ”¥" />
    </head>
    <body>
        <canvas id="draw" width="800" height="800"></canvas>

        <script>
            const canvas = document.querySelector("#draw");
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const canvasContext = canvas.getContext("2d");
            canvasContext.strokeStyle = "#BADA55"; // è¨­å®šå‹¾å‹’åœ–å½¢æ™‚ç”¨çš„é¡è‰²
            canvasContext.lineJoin = "round"; // è®“ç·šæ¢è½‰å½æ™‚å®ƒçš„æ‹è§’æ˜¯åœ“çš„
            canvasContext.lineCap = "round"; // è®“ç·šæ¢æœ«ç«¯æ˜¯åœ“çš„
            canvasContext.lineWidth = 10; // ç·šæ¢å¯¬åº¦
            // ctx.globalCompositeOperation = "multiply";
            const { startDrawing, exitDrawing, drawLine, drawSpecialLine } = new Draw(canvasContext);

            // events
            canvas.addEventListener("mousemove", drawLine);
            // canvas.addEventListener("mousemove", drawSpecialLine);
            canvas.addEventListener("mousedown", startDrawing);
            canvas.addEventListener("mouseup", exitDrawing);
            canvas.addEventListener("mouseout", exitDrawing);

            function Draw(canvasContext) {
                let lastPos = { x: 0, y: 0 };
                let isDrawing = false;
                return { startDrawing, exitDrawing, drawLine, drawSpecialLine: drawSpecialLine() };

                // helpers
                function startDrawing(e) {
                    isDrawing = true;
                    lastPos = [e.clientX, e.clientY];
                }
                function exitDrawing() {
                    isDrawing = false;
                }
                function drawLine(e) {
                    if (!isDrawing) return;
                    canvasContext.beginPath();
                    canvasContext.moveTo(lastPos.x, lastPos.y); // start from
                    canvasContext.lineTo(e.clientX, e.clientY); // go to
                    canvasContext.stroke();
                    lastPos = { x: e.clientX, y: e.clientY };
                }
                function drawSpecialLine() {
                    let hue = 0;
                    let isLineWidthIncreasing = true;

                    return function (e) {
                        // æ§åˆ¶é¡è‰²
                        canvasContext.strokeStyle = `hsl(${hue}, 100%, 50%)`;
                        hue += 10;

                        // æ§åˆ¶ç·šå¯¬
                        if (
                            canvasContext.lineWidth <= 5 || //
                            canvasContext.lineWidth >= 20
                        ) {
                            isLineWidthIncreasing = !isLineWidthIncreasing;
                        }
                        isLineWidthIncreasing === true //
                            ? canvasContext.lineWidth++
                            : canvasContext.lineWidth--;

                        drawLine(e);
                    };
                }
            }
        </script>

        <style>
            html,
            body {
                margin: 0;
            }
        </style>
    </body>
</html>
